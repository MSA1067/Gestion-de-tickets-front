<div class="flex justify-between mb-3">
  <h1 class="text-xl font-semibold">Administraci√≥n de usuarios - Buscar Usuarios</h1>
  <p-button label="Crear Usuario" (click)="showDialog()"/>
</div>

<p-card class="card grid">
  <div class="row-auto flex gap-3">

    <div class="col-span-12 md:col-4">
      <p-floatlabel variant="on" class="w-full md:w-80">
        <p-autoComplete
          [(ngModel)]="selectedName"
          [suggestions]="filteredNames"
          (completeMethod)="filterName($event)"
          field="name"
          inputId="name"
          [forceSelection]="false"
          styleClass="w-full"
          inputStyleClass="w-full"
        />
        <label for="name">Nombre</label>
      </p-floatlabel>
    </div>

    <div class="col-12 md:col-4">
      <p-floatlabel variant="on" class="w-full md:w-80">
        <p-autoComplete
          [(ngModel)]="selectedUsername"
          [suggestions]="filteredUsernames"
          (completeMethod)="filterUsername($event)"
          field="username"
          inputId="username"
          [forceSelection]="false"
          styleClass="w-full"
          inputStyleClass="w-full"
        />
        <label for="username">Usuario</label>
      </p-floatlabel>
    </div>



    <div class="col-12 md:col-4">
      <p-floatlabel variant="on" class="w-60 md:w-50">
        <p-multiselect
          id="rol"
          [(ngModel)]="selectedRole"
          [options]="roles"
          optionLabel="name"
          optionValue="value"
          filter
          [maxSelectedLabels]="2"
          styleClass="w-60"
        ></p-multiselect>
        <label for="rol">Rol</label>
      </p-floatlabel>

    </div>

    <div class="col-12 flex gap-2">
      <p-button label="Buscar" icon="pi pi-search" (click)="loadUsers()" />
      <p-button label="Limpiar" icon="pi pi-refresh" severity="secondary" (click)="resetFilters()" />
    </div>
  </div>

  <div class="card mt-4">
    <p-table
      [value]="users"
      [paginator]="true"
      [rows]="pageSize"
      [totalRecords]="totalElements"
      [lazy]="true"
      (onLazyLoad)="onLazyLoad($event)"
      [loading]="loading"
      [rowsPerPageOptions]="[1, 10, 20]"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Mostrando {first} - {last} de {totalRecords}">

      <ng-template pTemplate="header">
        <tr>
          <th>Nombre</th>
          <th>Usuario</th>
          <th>Email</th>
          <th>Rol</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-user>
        <tr>
          <td>{{ user.name }}</td>
          <td>{{ user.username }}</td>
          <td>{{ user.email }}</td>
          <td>{{ translateRole(user.role) }}</td>
          <td> {{ user.active === 'S' ? 'Activo' : 'Inactivo' }}</td>
          <td class="color-edit" (click)="showDialogEdit(user)"><i class="pi pi-pencil" style="font-size: 1rem"> </i> Editar</td>
        </tr>
      </ng-template>

    </p-table>
  </div>
</p-card>

<p-dialog header="Crear Usuario" [modal]="true" [(visible)]="visible" [position]="'top'" [style]="{ width: '45%' }">
  <app-create-manage-users
    (close)="onCloseModal()"
    (saved)="onSaveAndRefresh()">
  </app-create-manage-users>
</p-dialog>

<p-dialog
  header="Editar Usuario"
  [modal]="true"
  [(visible)]="visibleEdit"
  [position]="'top'"
  [style]="{ width: '45%' }"
>
  <app-edit-manage-users
    [userToEdit]="selectedUser"
    (close)="onCloseModalEdit()"
    (saved)="onSaveAndRefreshEdit()"
  >
  </app-edit-manage-users>
</p-dialog>
