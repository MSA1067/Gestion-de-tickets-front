<div class="flex justify-content-between align-items-center mb-3">
  <h1 class="text-xl font-semibold">Administración de usuarios</h1>
</div>

<p-card class="card grid">

  <div class="row-auto flex gap-3">

    <div class="col-12 md:col-4">
      <p-floatlabel>
        <p-autoComplete
          [(ngModel)]="selectedName"
          [suggestions]="filteredNames"
          (completeMethod)="filterName($event)"
          field="name"
          inputId="name"
          [forceSelection]="false"
        />
        <label for="name">Nombre</label>
      </p-floatlabel>
    </div>

    <div class="col-12 md:col-4">
      <p-floatlabel>
        <p-autoComplete
          [(ngModel)]="selectedUsername"
          [suggestions]="filteredUsernames"
          (completeMethod)="filterUsername($event)"
          field="username"
          inputId="username"
          [forceSelection]="false"
        />
        <label for="username">Usuario</label>
      </p-floatlabel>
    </div>

    <div class="col-12 md:col-4">

      <p-floatlabel class="w-full md:w-80">
        <p-multiselect id="rol" [(ngModel)]="selectedRole" [options]="roles" optionLabel="name" optionValue="value" filter [maxSelectedLabels]="3" styleClass="w-full"></p-multiselect>
        <label for="rol">Rol</label>
      </p-floatlabel>

    </div>

    <div class="col-12 flex gap-2">
      <p-button label="Buscar" icon="pi pi-search" (click)="loadUsers()" />
      <p-button label="Limpiar" icon="pi pi-refresh" severity="secondary" (click)="resetFilters()" />
    </div>
  </div>

  <div class="card mt-4">
    <p-table
      [value]="users"
      [paginator]="true"
      [rows]="pageSize"
      [totalRecords]="totalElements"
      [lazy]="true"
      (onLazyLoad)="onLazyLoad($event)"
      [loading]="loading"
      [rowsPerPageOptions]="[1, 10, 20]"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Mostrando {first} - {last} de {totalRecords}">

      <ng-template pTemplate="header">
        <tr>
          <th>Nombre</th>
          <th>Usuario</th>
          <th>Email</th>
          <th>Rol</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-user>
        <tr>
          <td>{{ user.name }}</td>
          <td>{{ user.username }}</td>
          <td>{{ user.email }}</td>
          <td>{{ translateRole(user.role) }}</td>
          <td> {{ user.active === 'S' ? 'Sí' : 'No' }}</td>
          <td class="color-edit"><i class="pi pi-pencil" style="font-size: 1rem"> </i> Editar</td>
        </tr>
      </ng-template>

    </p-table>
  </div>
</p-card>


