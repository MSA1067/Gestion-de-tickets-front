<div class="h-[calc(100vh-80px)] overflow-y-auto pr-3 p-4">

  <!-- KPI row -->
  <div class="flex flex-wrap gap-4 justify-around mb-6">
    <p-card class="w-64 shadow-sm border-l-4 border-blue-600">
      <div class="flex items-center gap-4 py-4">
        <i class="pi pi-chart-line text-blue-600 text-4xl"></i>
        <div>
          <span class="text-3xl font-bold text-blue-700">{{ totals.total }}</span>
          <p class="text-gray-600 text-sm">Tickets totales</p>
        </div>
      </div>
    </p-card>

    <p-card class="w-64 shadow-sm border-l-4 border-green-600">
      <div class="flex items-center gap-4 py-4">
        <i class="pi pi-clock text-green-600 text-4xl"></i>
        <div>
          <span class="text-3xl font-bold text-green-700">{{ totals.active }}</span>
          <p class="text-gray-600 text-sm">Tickets activos</p>
        </div>
      </div>
    </p-card>

    <p-card class="w-64 shadow-sm border-l-4 border-gray-600">
      <div class="flex items-center gap-4 py-4">
        <i class="pi pi-check text-gray-600 text-4xl"></i>
        <div>
          <span class="text-3xl font-bold text-gray-700">{{ totals.closed }}</span>
          <p class="text-gray-600 text-sm">Tickets cerrados</p>
        </div>
      </div>
    </p-card>
  </div>

  <!-- Charts row: 2 charts in one row (states and priority) -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">

    <p-card class="shadow-md rounded-xl">
      <div class="flex items-center mb-3">
        <h3 class="text-lg font-semibold">Estados (todos los tickets)</h3>
      </div>

      <p-chart
        type="bar"
        [data]="statesChartData"
        [options]="statesChartOptions"
        style="height: 320px"
      ></p-chart>
    </p-card>

    <p-card class="shadow-md rounded-xl">
      <div class="flex items-center mb-3">
        <h3 class="text-lg font-semibold">Prioridad (todos los tickets)</h3>
      </div>

      <p-chart
        type="pie"
        [data]="priorityChartData"
        [options]="priorityChartOptions"
        style="height: 320px"
      ></p-chart>
    </p-card>

  </div>

  <!-- Table: Tickets asignados -->
  <p-card class="shadow-md rounded-xl">
    <div class="flex items-center justify-between mb-3">
      <h3 class="text-lg font-semibold">Tickets asignados</h3>
      <small class="text-sm text-gray-500">Última actualización: {{ lastUpdated | date:'short' }}</small>
    </div>

    <p-table [value]="assignedRows" [paginator]="false" styleClass="p-datatable-sm">
      <ng-template pTemplate="header">
        <tr>
          <th>Usuario</th>
          <th class="text-center">Activos</th>
          <th class="text-center">En Progreso</th>
          <th class="text-center">Cerrados</th>
          <th class="text-center">Total</th>
          <th class="text-center">Estado</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-row>
        <tr>
          <td>
            <div class="flex items-center gap-3">
              <img *ngIf="row.avatar" [src]="row.avatar" class="w-8 h-8 rounded-full" alt="avatar" />
              <div>
                <div class="font-medium">{{ row.userName }}</div>
                <div class="text-xs text-gray-500">{{ row.userEmail }}</div>
              </div>
            </div>
          </td>
          <td class="text-center">
            <span class="font-semibold">{{ row.active }}</span>
          </td>
          <td class="text-center">
            <span class="font-semibold">{{ row.inProgress }}</span>
          </td>
          <td class="text-center">
            <span class="font-semibold">{{ row.closed }}</span>
          </td>
          <td class="text-center">
              <span class="font-semibold">{{ getAssignedTotal(row) }}</span>


          </td>
          <td class="text-center">
              <p-tag
                [value]="getLoadLabel(row)"
                [severity]="getLoadSeverity(row)"
                styleClass="p-tag-sm"
              ></p-tag>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>

</div>
